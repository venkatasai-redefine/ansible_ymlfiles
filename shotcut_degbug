---
- name: Gather debug information from 300 Linux machines
  hosts: all
  gather_facts: no
  tasks:
    - name: Run a dummy command (e.g., uptime) to collect debug info
      command: uptime
      register: uptime_output
      ignore_errors: yes  # Continue if any command fails

    - name: Collect debug information for the command
      debug:
        msg: |
          Host: {{ inventory_hostname }}
          Command: uptime
          stdout: "{{ uptime_output.stdout }}"
          stderr: "{{ uptime_output.stderr }}"
          returncode: "{{ uptime_output.rc }}"
          failed: "{{ uptime_output.failed }}"
          ---

    - name: Append debug information to a file in /tmp directory
      local_action:
        module: copy
        content: |
          Host: {{ inventory_hostname }}
          Command: uptime
          stdout: "{{ uptime_output.stdout }}"
          stderr: "{{ uptime_output.stderr }}"
          returncode: "{{ uptime_output.rc }}"
          failed: "{{ uptime_output.failed }}"
          ---
        dest: "/tmp/all_debug_info.txt"
        append: yes  # Appends the debug info from each host to the same file
        mode: '0644'
