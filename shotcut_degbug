---
- name: Gather debug information from 300 Linux machines
  hosts: all
  gather_facts: no
  tasks:
    - name: Run a dummy command to collect debug info (e.g., "uptime")
      command: uptime
      register: uptime_output
      ignore_errors: yes  # In case of failure, continue to the next host

    - name: Collect debug information
      debug:
        msg: |
          Host: {{ inventory_hostname }}
          Command: uptime
          stdout: "{{ uptime_output.stdout }}"
          stderr: "{{ uptime_output.stderr }}"
          returncode: "{{ uptime_output.rc }}"
          failed: "{{ uptime_output.failed }}"
          ---
    
    - name: Append all debug information to a central output file
      local_action:
        module: copy
        content: |
          Host: {{ inventory_hostname }}
          Command: uptime
          stdout: "{{ uptime_output.stdout }}"
          stderr: "{{ uptime_output.stderr }}"
          returncode: "{{ uptime_output.rc }}"
          failed: "{{ uptime_output.failed }}"
          ---
        dest: "/tmp/all_debug_info.txt"
        append: yes
        mode: '0644'
