---
- hosts: all
  gather_facts: false
  tasks:
    - name: Run uptime command
      command: uptime
      register: uptime_output

    - name: Create debug info directory (if it doesn't exist)
      file:
        path: /tmp/debug_info
        state: directory
      delegate_to: localhost # Run this only on the control node

    - name: Append uptime output to a single file
      local_action:
        module: lineinfile
        path: /tmp/debug_info/uptime_all_hosts.txt
        line: "{{ inventory_hostname }}: {{ uptime_output.stdout }}"
        create: yes
